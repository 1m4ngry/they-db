<html>
<head>
<!-- This file has been generated by unroff 1.0, 02/21/97 22:49:39. -->
<!-- Do not edit! -->
<title>man-db</title>
</head><body>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--  format an environment variable -->
<!--  end -->
<!--  Begin a new (sub)section, add to TOC -->
<!--  end -->
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<p>
<br><center><b>man_db-2.3.x - the database cached manual pager suite
</b>

<br>
Graeme W. Wilford &lt;eep2gw@ee.surrey.ac.uk&gt;
<br>
</center>
<p>
<p>
<p>
<p>
<dl><dt><dd>This document describes the setup, maintenance and use of a generic online
manual page system with special reference to the man_db-2.3.x package and it's
advanced features.<tt> </tt>
</dl>
<!-- .he '\*M''\*(td' -->
<!-- .fo ''%'' -->
<br>
<!--  Start the manual -->
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
<b>UNIX</b> is a registered trademark of the X/Open Company, Ltd.<tt> </tt>
<br>
NFS is a registered trademark of Sun Microsystems, Inc.<tt> </tt>
<br>
PostScript is a registered trademark of Adobe in the United States.<tt> </tt>
<p>
The general conventions used throughout this manual include
file names and paths in
<i>italic</i>,
eg. 
<i>/usr/man</i>.<tt> </tt>
variable strings (usually path components) enclosed within &lt;&gt; and in 
<i>italic</i>,
eg.<tt> </tt>
<i>&lt;sec&gt;</i>,
program names in
<b>bold</b>,
eg.<tt> </tt>
<b>man</b>.<tt> </tt>
commands that can be typed at a shell prompt in a 
eg.<tt> </tt>
environment variables denoted as follows:
$<b>ENV_VAR
</b><p>
<br>Copyright &#169; 1995 Graeme W. Wilford
<p>
Permission is granted to make and distribute verbatim copies of this manual
provided the copyright notice and this permission notice are preserved on
all copies.<tt> </tt>
<p>
Permission is granted to copy and distribute modified versions of this
manual under the conditions for verbatim copying, provided that the entire
resulting derived work is distributed under the terms of a notice identical
to this one.<tt> </tt>
<p>
Permission is granted to copy and distribute translations of this manual
into another language, under the above conditions for modified versions,
except that this permission notice may be stated in a translation approved
by the copyright holder.<tt> </tt>
<br>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
<!--  chap1.me -->
   .<tt> </tt>
<br>
<h2>Introduction</h2>
<a name="toc0">&#160;</a>
<a name="toc1">&#160;</a>
<br>
   .<tt> </tt>
<h2>man_db-2.3.x</h2>
<a name="toc2">&#160;</a>
<br>
<p>
man_db-2.3.x is a package that is designed to provide users with online information
in a fast and friendly manner while at the same time offering flexibility to
the system administrator. 
<pre>It is made up of several user programs:
	       man	- an interface to the on-line reference manuals
	       whatis	- search the manual page names
	       apropos	- search the manual page names and descriptions
	       manpath	- determine search path for manual pages
several maintenance programs:
	       mandb	- create or update the manual page index caches
	       catman	- create or update the pre-formatted manual pages
and a special pre-formatter that knows about compressed manual pages
	       zsoelim	- satisfy .so requests in roff input
</pre>

In addition to these compiled programs, there are two shell scripts, 
<b>mkcatdirs
</b>and
<b>checkman
</b>in the
<i>tools
</i>subdirectory.<tt> </tt>
These scripts aid the creation of cat directories and
check for duplicated manual pages, respectively.<tt> </tt>
<p>
The following manual pages are provided with this package to explain correct
format and usage.<tt> </tt>
<b>man</b>(1),
<b>whatis</b>(1),
<b>apropos</b>(1),
<b>manpath</b>(1),
<b>manpath</b>(5),
<b>mandb</b>(8),
<b>catman</b>(8)
and
<b>zsoelim</b>(1).<tt> </tt>
   .<tt> </tt>
<h2>The concept</h2>
<a name="toc3">&#160;</a>
<br>
<p>
man_db-2.3.x originally started out life as program suite man-1.1B, written by John W.<tt> </tt>
Eaton &lt;jwe@che.utexas.edu&gt; and maintained by Rik Faith &lt;faith@cs.unc.edu&gt;
to which support proposed by the newly
formed <b>FSSTND</b> committee regarding cat directories was added.<tt> </tt>
<p>
Since then, man_db-2.3.x's most innovative feature: the database cache scheme<a href="#footnote1"><b>[1]</b></a>
has been significantly developed. The basic idea was to reduce manual page
search times to a minimum. The following piece of text is included from the
man_db-2.2 distribution:
<blockquote>
The theory: If you go to a library to take a book out, what do you do?<tt> </tt>
<p>
a) Go and look where it might be on a micro-fiche/terminal, take a look
   where it is supposed to be on the shelf, and then go look at the new
   arrivals if it's not where it's supposed to be?<tt> </tt>
<p>
OR
<p>
b) Start at one end of the ground floor, look along every bookshelf
   until you've completed that floor, then go up a level and start again
   until you've found what you're looking for?<tt> </tt>
</blockquote>
<p>
Since then the database 
<b>index
</b>scheme has evolved greatly.<tt> </tt>
Every manual page and stray cat page on the system is registered in an 
<b>index
</b>database cache which stores various details about the file including the
timestamp, the location and the whatis<a href="#footnote2"><b>[2]</b></a>
information. This information is kept up to date by
<b>man
</b>which looks for filesystem changes each time it is invoked.<tt> </tt>
   .<tt> </tt>
<h2>The manual page system</h2>
<a name="toc4">&#160;</a>
<br>
<p>
The simplest manual page system will have a single manual page hierarchy.<tt> </tt>
This will typically be
<ul>
<li><i>/usr/man
</i></ul>
<p>
beneath which will be several subdirectories of the form 
<i>man&lt;sec&gt;
</i>where
<i>&lt;sec&gt;
</i>is 
<b>1</b>,
<b>2</b>,
<b>3</b>,
<b>4</b>,
<b>5</b>,
<b>6</b>,
<b>7
</b>or 
<b>8</b>.<tt> </tt>
These are referred to as 
<i>sections
</i>of the
manual. Others may exist and they are not restricted to single
character names. eg.<tt> </tt>
<ul>
<li><i>/usr/man/manfoo
</i></ul>
<p>
is a valid section subdirectory. 
Other common sections include 
<b>9</b>,
<b>n</b>,
<b>l</b>,
<b>p
</b>and 
<b>o</b>.<tt> </tt>
<p>
Within these section subdirectories reside the manual pages themselves. Their
filenames follow the pattern 
<ul>
<li><i>/usr/man/man&lt;sec&gt;/&lt;name&gt;.&lt;sec&gt;&lt;ext&gt;
</i></ul>
<p>
where in most cases 
<i>&lt;ext&gt;
</i>is an empty string.<tt> </tt>
An example is manual page
<b>cp
</b><ul>
<li><i>/usr/man/man1/cp.1
</i></ul>
<p>
which resides in 
<i>section
</i><b>1
</b>and has no special 
<i>extension</i>.<tt> </tt>
<p>
   .<tt> </tt>
<h2>Sections of the manual</h2>
<a name="toc5">&#160;</a>
<br>
<p>
The manual is split up into sections to ease access and to cater for manual
pages that share the same name. It is common for a
program and function to share the same name.<tt> </tt>
<b>kill
</b>is a good example.<tt> </tt>
This is both a program which can be used to send a process a signal and
an operating system call with similar functionality. Their manual pages are
stored under sections
<b>1
</b>and
<b>2
</b>respectively.<tt> </tt>
Thus, sections are used to separate out the program manual pages from the 
function manual pages and so on.<tt> </tt>
The table below shows the
<i>section
</i>numbers of the manual followed by the types of pages they contain.<tt> </tt>

<pre>+---------+------------------------------------------------------+
| Section |		   Section contents			 |
+---------+------------------------------------------------------+
|    1    | user executable programs or shell commands		 |
|    2    | system calls (functions provided by the kernel)	 |
|    3    | library calls (functions within system libraries)	 |
|    4    | special files (usually found in /dev)		 |
|    5    | file formats and conventions eg. /etc/passwd	 |
|    6    | games						 |
|    7    | macro packages and conventions eg. man(7), groff(7). |
|    8    | system administration commands			 |
|    9    | kernel routines [Non standard]			 |
|    n    | new [obsolete]					 |
|    l    | local [obsolete]					 |
|    p    | public [obsolete]					 |
|    o    | old [obsolete]					 |
+---------+------------------------------------------------------+
</pre>

   .<tt> </tt>
<h2>The format of manual pages</h2>
<a name="toc6">&#160;</a>
<br>
<p>
The format in which manual pages are stored is <b>NROFF</b>/<b>TROFF</b> or more generally ROFF. 
This is a typesetter style language<a href="#footnote3"><b>[3]</b></a>
which requires formatting before
being viewed. In fact some manual pages require pre-format processing to 
correctly format tables or equations.<tt> </tt>
<p>
If the page is to be viewed on screen in a text environment, <b>NROFF</b> is
used as the primary formatter. If the page is to be printed or displayed in a
graphical environment, <b>TROFF</b> is used. Traditionally, <b>TROFF</b>
formatted files for a 
<b>C/A/T
</b>(Computer aided Typesetter) which is now obsolete.<tt> </tt>

The <b>GNU</b> ROFF (<b>GROFF</b><a href="#footnote4"><b>[4]</b></a>)
suite of programs offer a choice of output types
including 
<b>X</b>,
<b>dvi
</b>and 
<b>postscript</b>.<tt> </tt>
When configuring man_db-2.3.x, the preference is
to use <b>GROFF</b> rather than <b>TROFF</b>.<tt> </tt>
   .<tt> </tt>
<h2>Arguments to configure</h2>
<a name="toc7">&#160;</a>
<br>
<p>
To allow the configuration program,  
<b>configure</b>,
to be non-interactive, it can be passed various options to alter the
default settings. 
Generic 
<b>configure
</b>options are discussed in 
<i>docs/INSTALL</i>.<tt> </tt>
Options that are specific to the man_db-2.3.x package are described below.<tt> </tt>
<p>
<dl compact>
<dt>--enable-debug<dd>By default, the configuration process creates production quality Makefiles. 
This
option, which takes no argument, changes certain values to aid in debugging
man_db-2.3.x. It does not alter the physical behaviour of any of the programs.<tt> </tt>
<dt>--enable-setuid[=ARG]<dd>By default, 
<b>man
</b>will be installed as a setuid program to user man. Use this option with an
argument to change the setuid owner. 
<dt>--disable-setuid<dd>Use this option to install
<b>man
</b>as a non-setuid program and to change the default cat and database files'
access flags to allow users to modify them.<tt> </tt>
<dt>--with-device=DEVICE<dd>Use this flag to alter the default output device used by <b>NROFF</b>. DEVICE is
passed to <b>NROFF</b> with the -T option. 
<b>configure
</b>will test that <b>NROFF</b> will run with the supplied device argument.<tt> </tt>
<dt>--with-db=LIBRARY<dd>configure will look for database interface libraries in the order Berkeley
DB, gdbm and finally ndbm and will #define appropriate variables relative to
the first one found. To override the built in order on platforms having a
choice of interface library, use this option to specify which library to
use.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
</dl>
<h2>The specifics of Sections</h2>
<a name="toc8">&#160;</a>
<a name="toc9">&#160;</a>
<br>
   .<tt> </tt>
<h2>Package specific manual page sections</h2>
<a name="toc10">&#160;</a>
<br>
<p>
The use of package specific manual page
sections is discouraged as packages large enough to warrant their own
section probably contain manual pages that span other sections. An example
might be package  
<b>foo
</b>that has it's own section
<ul>
<li><i>/usr/man/manfoo
</i></ul>
<p>
which contains manual pages
describing it's programs, the library routines it offers and the format of
several of its configuration files. These pages would normally be allocated
to sections 
<b>1</b>,
<b>3
</b>and 
<b>5
</b>respectively and thus combining them all under section 
<b>foo
</b>is misleading. Subtle problems will arise if there are any
base name-space clashes with standard manual pages, eg. 
<b>exit</b>(3),
<b>exit</b>(foo)
and the order in which they should be shown.<tt> </tt>
<p>
There are two standard solutions to this problem.<tt> </tt>
<dl compact>
<dt>1<dd>Create a separate manual page hierarchy for the package's manual pages such as
<dl><dt><dd><i>/usr/local/packages/foo/man
</i></dl>
<dt>2<dd>Install the pages in their relevant sections, with a unique extension
appended to the filename such that
<dl><dt><dd><i>/usr/man/manfoo/exit.foo
</i></dl>
would instead be installed as
<dl><dt><dd><i>/usr/man/man1/exit.1foo
</i></dl>
</dl>
<p>
Only (2) offers a complete
solution to manual page ordering problems and
allows users to access the desired page directly.<tt> </tt>
   .<tt> </tt>
<h2>Selecting a section type</h2>
<a name="toc11">&#160;</a>
<br>
   .<tt> </tt>
<h2>Specifying a section</h2>
<a name="toc12">&#160;</a>
<br>
<p>
This is done via use of the section argument to man
<ul>
<li>man 1 exit
</ul>
<p>
will look for 
<i>exit.1*
</i>in section 
<b>1
</b>of the manual. If
<i>exit.1
</i>exists, it will be displayed in preference to 
<i>exit.1foo
</i><ul>
<li>man 1foo exit
</ul>
<p>
will look for  
<i>exit.1foo*
</i>in section 
<b>1
</b>of the manual. The asterisk (*)
represents a wild-card of any type or length, including length zero. 
<p>
For an argument to be interpreted as a section name rather than a page name, it
must either begin with a digit, or be included in the standard section list.<tt> </tt>
The default section list is defined in
<i>include/manconfig.h
</i>to be
<b>1</b>,
<b>n</b>,
<b>l</b>,
<b>8</b>,
<b>3</b>,
<b>2</b>,
<b>5</b>,
<b>4</b>,
<b>9</b>,
<b>6
</b>and
<b>7</b>.<tt> </tt>
This should be modified in order and content to meet the local conventions.<tt> </tt>
<p>
Every subdirectory section name in the entire system must be in the list, 
including sections found in imported manual page hierarchies. The order is
important because in normal operation, 
<b>man
</b>will only display the first manual page it finds that meets the search
criteria. Using the
<b>--all
</b>argument will cause 
<b>man
</b>to attempt to display all manual pages that meet the criteria. See 
<b>man</b>(1)
for further information.<tt> </tt>
<p>
Having an excess of sections listed will not slow
<b>man
</b>down.<tt> </tt>
   .<tt> </tt>
<h2>Specifying an extension</h2>
<a name="toc13">&#160;</a>
<br>
<p>
If the section is unknown, but the package extension is, 
it is possible to use the extension argument
<ul>
<li>man -e foo exit
</ul>
<p>
to search in all sections for manual pages named 
<i>exit
</i>from package
<i>foo</i>.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
<h2>Filesystem structure</h2>
<a name="toc14">&#160;</a>
<a name="toc15">&#160;</a>
<br>
   .<tt> </tt>
<h2>Manual page hierarchies</h2>
<a name="toc16">&#160;</a>
<br>
<p>
It is often common for manual page systems to have more than one manual page
hierarchy. Indeed one of the systems I use has the following globally 
accessible hierarchies
<ul>
<li><i>
/usr/man
<br>
/usr/local/man
<br>
/usr/local/tex/man
<br>
/usr/local/pbm/man
<br>
/usr/X11R6/man
<br>
/usr/openwin/man
<br>
/usr/local/packages/pvm/man
</i>
</ul>
<p>
A full system 
$<b>MANPATH
</b>would be a colon separated list of these directories
The order is important, and is observed by man_db's search algorithms. 
The order
is very much related to the users
$<b>PATH
</b>environment variable, and should be set on a per user basis, or not
set at all. If a user's 
$<b>PATH
</b>causes
<ul>
<li><i>/usr/local/packages/bin/foobar
</i></ul>
<p>
to be executed in preference to
<ul>
<li><i>/usr/bin/foobar</i>,
</ul>
<p>
it is essential that 
<ul>
<li>man foobar
</ul>
<p>
displays the manual page located within 
<ul>
<li><i>/usr/local/packages/man
</i></ul>
<p>
rather than within
<ul>
<li><i>/usr/man
</i></ul>
<p>
To ensure correct order, the program 
<b>manpath
</b>may be used to set the
$<b>MANPATH
</b>environment variable. See
<b>manpath</b>(1)
and
<b>manpath</b>(5)
for details.<tt> </tt>
   .<tt> </tt>
<h2>Setting the MANPATH</h2>
<a name="toc17">&#160;</a>
<br>
<p>
If using a Bourne style login shell such as 
<b>bash</b>,
<b>ksh</b>,
or
<b>zsh</b>,
the commands
<ul>
<li>export MANPATH
<br>
MANPATH=`manpath -q`
</ul>
<p>
can be added to 
<b>$HOME</b><i>/.profile
</i><p>
If using a C style login shell such as 
<b>csh
</b>or
<b>tcsh</b>,
the commands
<ul>
<li>setenv MANPATH `manpath -q`
</ul>
<p>
can be added to
<b>$HOME</b><i>/.login
</i><p>
N.B. 
$<b>PATH
</b>must be set prior to using
<b>manpath</b>.<tt> </tt>
The setting of
$<b>MANPATH
</b>is actually unnecessary as the man_db-2.3.x utilities will dynamically determine the
manpath if 
$<b>MANPATH
</b>is unset.<tt> </tt>
   .<tt> </tt>
<h2>Determination of the internal manpath</h2>
<a name="toc18">&#160;</a>
<br>
<p>
All man_db utilities, 
<b>manpath
</b>included, will use the user's
$<b>MANPATH
</b>environment variable if set and not equal to "".  Otherwise the user's 
$<b>PATH
</b>environment variable is queried.  If this is unset or is set to "", the
determined manpath will simply be any 
<ul>
<li><b>MANDATORY_MANPATH
</b></ul>
<p>
elements defined in the man_db config file.<tt> </tt>
<p>
Assuming that a
$<b>PATH
</b>exists, each path element it contains is scanned for in the config file.  If
found, the relative manpath element is appended to the internal manpath.<tt> </tt>
However, if the element is not mentioned in the config file, a man directory
relative to it will be sought.  The subdirectories
<i>../man
</i>or
<i>man
</i>relative to the path component are appended to the internal manpath if they
exist.  Finally, the internal manpath is stripped of duplicate paths before
being processed by the
<b>NLS
</b>and `Other OS' routines. These may add to or modify the separate path
elements giving priority to
<b>NLS
</b>manual pages or add OS-relative manpaths.<tt> </tt>
   .<tt> </tt>
<h2>Other OS's manual pages</h2>
<a name="toc19">&#160;</a>
<br>
<p>
It is common to have collections of heterogeneous computer systems linked
together in a network. In some circumstances<a href="#footnote5"><b>[5]</b></a> 
it is advantageous to be able to access the manual 
pages of these other systems directly from your system.<tt> </tt>
This feature is known as alternate system support. The accepted way to
setup this support is to NFS mount the respective systems' manual page
hierarchies under the native manual page hierarchies. An example:

<pre>
		+--------+-----------------------+
		| System | Manual page hierarchy |
		+--------+-----------------------+
		|&lt;local&gt; | /usr/man              |
		| newOS  | /usr/man/newOS        |
		| userix | /usr/man/userix       |
		|&lt;local&gt; | /usr/local/man        |
		| newOS  | /usr/local/man/newOS  |
		| userix | /usr/local/man/userix |
		+--------+-----------------------+
</pre>

Rather than have multiple NFS mounts from a single machine, this may be
accomplished by NFS mounting 
<ul>
<li><i>&lt;other-sys&gt;:/usr
</i></ul>
<p>
somewhere on the local system and using symbolic links within the manual
hierarchies.<tt> </tt>
To access these 
<i>alternate systems
</i>using 
<b>man
</b>use the 
<b>-m
</b>option, eg.<tt> </tt>
<ul>
<li>man --all --system userix:newOS 5 passwd
</ul>
<p>
would provide manual pages showing the structure of
<i>/etc/passwd
</i>on systems
<b>userix
</b>and
<b>newOS
</b>in that order.<tt> </tt>
A manual page would
<i>not
</i>be displayed about the local systems conventions.  
Please read the relevant man_db utility's manual
page for further and more specific information.<tt> </tt>
   .<tt> </tt>
<h2>NLS manual pages</h2>
<a name="toc20">&#160;</a>
<br>
<p>
<!-- With appropriate font support, it is possible to access and display -->
<!-- .q "Native Language Support" -->
<!-- manual pages. -->
<!-- .lp -->
NLS manual pages should be put in NLS subdirectories of a standard manual
page hierarchy. 
A table illustrating the concept is reproduced from the 
``Linux Filesystem Structure''<a href="#footnote6"><b>[6]</b></a>
(<b>FSSTND</b>) manual from which further information may be obtained.<tt> </tt>

<pre>+----------+----------------+-----------------+----------------------+
| Language | Territory      | Character Set   | Directory            |
+----------+----------------+-----------------+----------------------+
| English  | --             | ASCII           | /usr/man/en          |
| English  | United Kingdom | ASCII           | /usr/man/en_GB       |
| English  | United States  | ASCII           | /usr/man/en_US       |
| French   | Canada         | ISO 8859-1      | /usr/man/fr_CA       |
| French   | France         | ISO 8859-1      | /usr/man/fr_FR       |
| German   | Germany        | ISO 646         | /usr/man/de_DE.646   |
| German   | Germany        | ISO 6937        | /usr/man/de_DE.6937  |
| German   | Germany        | ISO 8859-1      | /usr/man/de_DE.88591 |
| German   | Switzerland    | ISO 646         | /usr/man/de_CH.646   |
| Japanese | Japan          | JIS             | /usr/man/ja_JP.jis   |
| Japanese | Japan          | SJIS            | /usr/man/ja_JP.sjis  |
| Japanese | Japan          | UJIS (or EUC-J) | /usr/man/ja_JP.ujis  |
+----------+----------------+-----------------+----------------------+
</pre>

Each of these directories are then interpreted as manual page hierarchies
themselves and may
contain the usual section subdirectories.<tt> </tt>
Access to NLS manual pages is achieved via use of the
<b>setlocale</b>(3)
function which queries user environment variables to
determine the current locale. Internally to the man_db utilities, this
locale string is appended to each manpath element and the resultant NLS manpath
element is 
searched before the standard manpath element. In this way, an NLS manual page 
that matches the search criteria will be shown before or in place of the standard
American English page.<tt> </tt>
<p>
If a user's 
$<b>MANPATH
</b>consists of or is determined as
<ul>
<li><i>/usr/local/man:/usr/man:/usr/X11R6/man
</i></ul>
<p>
and their locale is set to  
<b>de_DE</b>,
the command
<ul>
<li>man --system userix:man foobar
</ul>
<p>
would produce the following internal man_db manpath elements
<ul>
<li><i>
</i><i>/usr/local/man/userix/de_DE
<br>
/usr/local/man/userix
<br>
/usr/man/userix/de_DE 
<br>
/usr/man/userix
<br>
/usr/X11R6/man/userix/de_DE
<br>
/usr/X11R6/man/userix
<br>
/usr/local/man/de_DE
<br>
/usr/local/man
<br>
/usr/man/de_DE
<br>
/usr/man/man
<br>
/usr/X11R6/man/de_DE
<br>
/usr/X11R6/man
<br>
</i><i></i>
</ul>
<p>
<b>foobar
</b>would be searched for in the order of manual page hierarchies listed.<tt> </tt>
   .<tt> </tt>
<h2>ISO 8859-1 (latin1) manual pages</h2>
<a name="toc21">&#160;</a>
<br>
<p>
By default <b>NROFF</b> will format manual pages into a form suitable
for a typewriter style device, e.g. a terminal screen. <b>GNU</b> <b>NROFF</b> is
capable<a href="#footnote7"><b>[7]</b></a>
of formatting ROFF into a form suitable for 8-bit latin1 capable output
devices. To enable output for such a device, give the option
<dl compact>
<dt>--with-device=DEVICE<dd></dl>
<p>
to 
<b>configure
</b>where DEVICE
is the suitable and supported output format, in this case 
<b>latin1</b>.<tt> </tt>
   .<tt> </tt>
<h2>Displaying latin1 characters on a Linux virtual terminal</h2>
<a name="toc22">&#160;</a>
<br>
<p>
To enable console based viewing of latin1 characters on a Linux system, you
must have the kbd<a href="#footnote8"><b>[8]</b></a> package installed.<tt> </tt>
The following commands included within an initialisation file such as
<i>/etc/rc.d/rc.local
</i>will enable the display of latin1 fonts on the first 5 virtual terminals.<tt> </tt>
<!--  no fill -->

<br>
---&lt; part of /etc/rc.d/rc.local &gt;---
<br>
# sort out the vt font
<br>
if [ -x /bin/setfont ]; then
<br>
        /bin/setfont /etc/kbd/consolefonts/lat1-16.psf
<br>
fi      
<br>

<br>
# load the keymap transformation to do when activating new font
<br>
if [ -x /bin/mapscrn ]; then
<br>
        /bin/mapscrn /etc/kbd/consoletrans/trivial
<br>
fi     
<br>

<br>
# enable new font
<br>
for t in 1 2 3 4 5; do
<br>
   echo -n -e "\033(K" &gt; /dev/tty$t
<br>
done
<br>
---&lt; part of /etc/rc.d/rc.local &gt;---
<br>
 
<br>
<!--  fill (default) -->
For display under the 
``X Window System'',
a suitable 8 bit clean terminal emulator is required.<tt> </tt>
   .<tt> </tt>
<h2>Viewing ASCII pages formatted for latin1 output device</h2>
<a name="toc23">&#160;</a>
<br>
<p>
When formatting an ASCII manual page for a latin1 output device, 
<b>GNU</b> <b>NROFF</b>
will take advantage of the extra characters available and will always 
produce a text page containing some latin1 (8-bit) symbols. The table<a href="#footnote9"><b>[9]</b></a>
below, taken from 
<b>man</b>(1)
illustrates the
differences.<tt> </tt>

<pre>       +---------------------+-------+------------+-------+
       | Description         | Octal | ISO 8859-1 | ASCII |
       +---------------------+-------+------------+-------+
       | continuation hyphen |  255  |     &#173;      |   -   |
       | bullet (middle dot) |  267  |     &#183;      |   o   |
       | acute accent        |  264  |     &#180;      |   '   |
       | multiplication sign |  327  |     &#215;      |   x   |
       +---------------------+-------+------------+-------+
</pre>

To display such symbols on a 7 bit terminal or terminal emulator, they
must be translated back into standard ASCII. The 
<b>-7
</b>option with 
<b>man
</b>will enable this simple reverse translation.<tt> </tt>
<p>
This option may be useful if your site has both 7 and 8-bit capable output
devices and nroff is using the latin1 output device to format manual pages.<tt> </tt>
   .<tt> </tt>
<h2>Cat pages</h2>
<a name="toc24">&#160;</a>
<br>
<p>
It has become standard practice to store the formatted manual pages on disk
so that subsequent requests for the manual page do not have to involve the
formatting process. These pre-formatted manual pages are known as
<i>cat
</i>pages. Although cat pages require additional disk storage requirements, they
provide a substantial speed increase and their use is recommended.<tt> </tt>
<p>
The automatic support of storing and using cat pages is brought about by
simply creating suitable directories for them.<tt> </tt>
   .<tt> </tt>
<h2>Cat page hierarchies</h2>
<a name="toc25">&#160;</a>
<br>
<p>
Traditionally, cat pages were stored under the same manual hierarchy as
their source manual pages, in 
<i>cat&lt;sec&gt;
</i>subdirectories rather than 
<i>man&lt;sec&gt;</i>.<tt> </tt>
This situation is rather limiting in several situations
<ul>
<li>When it is advantageous to mount 
<i>/usr
</i>as a read-only filesystem. Cat pages cannot be supported in this situation
without use of symbolic links to various other areas of the filesystem. This
situation is a greater problem if the media itself is read-only, such as
CD-ROM.<tt> </tt>
When NFS mounting alternate OS's manual page hierarchies. The alternate
system may be under someone else's control and they may not want cat pages
stored on their system. In fact it is usually a good idea to export the
manual page filesystems read-only, or import them that way. It is possible to
avoid the problems, this time with even more symbolic links that
may need periodic updating.<tt> </tt>
<!-- .bu -->
<!-- When sharing  -->
<!-- .i /usr  -->
<!-- with several other machines. There may be a situation where two machines are -->
<!-- producing the same cat file at the same time. A corrupted cat file is the -->
<!-- probable result. -->
If there is a mixture of normal cat files and stray cats<a href="#footnote10"><b>[10]</b></a>,
it is very difficult to periodically 
<i>trim
</i>the cat space disk usage by removing seldom accessed cat files.<tt> </tt>
</ul>
<p>
To avoid all of these problems simultaneously, it was decided to support
local cat page directory caches. 
   .<tt> </tt>
<h2>Local cat page directory caches</h2>
<a name="toc26">&#160;</a>
<br>
<p>
Any location for cat page hierarchy may be specified in the 
man_db configuration file. The location of the database cache associated with 
each manual page hierarchy will always be at the root of the cat page
hierarchy. By default, the cat page hierarchy shadows the manual page
hierarchy.<tt> </tt>
The <b>FSSTND</b> 
proposes 
<i>/var/catman
</i>as the location for such directories although man_db-2.3.x allows any directory
hierarchy to be used.<tt> </tt>
The <b>FSSTND</b> path transformation rule is as follows
<ul>
<li><i>/usr/&lt;hierarchy&gt;/man/&lt;locale&gt;/man&lt;sec&gt;/page.&lt;sec&gt;&lt;ext&gt;
</i></ul>
<p>
should be formatted into the cat file
<ul>
<li><i>/var/catman/&lt;hierarchy&gt;/&lt;locale&gt;/cat&lt;sec&gt;/page.&lt;sec&gt;&lt;ext&gt;
</i></ul>
<p>
where the 
<i>&lt;locale&gt;
</i>directory component may be missing and 
<i>&lt;ext&gt;
</i>may be an empty string.<tt> </tt>
<p>
The suggestion is that stray cats are located in the traditional hierarchy
under
<i>/usr
</i>whereas re-creatable cat pages are stored under the local writable hierarchy
<i>/var/catman.
</i><b>man
</b>follows strict rules in determining which file is displayed.<tt> </tt>
<p>
As an example, the following route is
taken if all three files exist.<tt> </tt>
<dl compact>
<dt>1<dd>Check relative time stamps of the manual file and the traditional cat file.<tt> </tt>
If the cat file is up to date (has a more recent time stamp), display it.<tt> </tt>
<dt>2<dd>The traditional cat file is out of date. Check relative time stamps of the
manual file and the alternate cat file. If the cat file is up to date,
display it.<tt> </tt>
<dt>3<dd>The alternate cat file is out of date. Format the manual file and display
the result in the foreground, while updating the alternate cat file in the 
background.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
</dl>
<h2>Compression</h2>
<a name="toc27">&#160;</a>
<a name="toc28">&#160;</a>
<br>
   .<tt> </tt>
<h2>Compressed manual pages</h2>
<a name="toc29">&#160;</a>
<br>
<p>
It is possible to maintain a system of compressed manual pages. 
The use of
this feature is not recommended for systems that have adequate disk space to
store their manual pages uncompressed. Subsequent decompression of these
manual pages will
cause several bottlenecks in the formatting process.<tt> </tt>
<p>
Presently, the compression extension/decompressor pairs must be known at
compile time although any number may be defined and used. The following
structure is predefined in man_db-2.3.x

<pre>                   +----------+--------------+
                   |Extension | Decompressor |
                   +----------+--------------+
                   |   gz     | gzip -dc     |
                   |   z      | gzip -dc     |
                   |   Z      | compress -dc |
                   +----------+--------------+
</pre>

It is a relatively easy operation to include further pairs in this
structure. See 
<i>include/comp_src.h
</i>for details and an example.    
<p>
Support for compressed manual pages is compiled into the man_db-2.3.x utilities by
default. To completely disable this support, edit 
<i>include/config.h
</i>and comment out the following line
<p>
#define COMP_SRC 1
<p>
This will enable a minor speed increase, but note that support for stray cats
with any compression extension other than the default will also be disabled.<tt> </tt>
   .<tt> </tt>
<h2>Compressed cat pages</h2>
<a name="toc30">&#160;</a>
<br>
<p>
man_db-2.3.x compresses cat files by default. During configuration, 
<b>configure
</b>will try to find 
<b>gzip
</b>and if so, all cat files produced by
<b>man
</b>will be compressed with
<ul>
<li><b>gzip -7c
</b></ul>
<p>
and have a 
<b>.gz
</b>extension appended.<tt> </tt>
If 
<b>gzip
</b>is not found, 
<ul>
<li><b>compress -c
</b></ul>
<p>
is used as the compressor and the extension
<b>.Z
</b>is appended.<tt> </tt>
<p>
To store cat files in an uncompressed state and to disable compressed
extension processing completely, edit 
<i>include/config.h
</i>and comment out the following line
<p>
#define COMP_CAT 1
<p>
   .<tt> </tt>
<h2>Stray cats</h2>
<a name="toc31">&#160;</a>
<br>
<p>
Normally, 
<b>man
</b>will only look for cat files with the default compression extension. The
default compression extension is dependent on the default compressor and may
be an empty string if the support for compressed cats is disabled.<tt> </tt>
<p>
It is possible for a system to be supplied with stray cat files located in the 
traditional cat page hierarchy. To make matters worse, they may have 
compression extensions other than the default and reside on read-only media.<tt> </tt>
In such circumstances, stray cat files will be accepted with any compression
extension that is also supported for manual pages.<tt> </tt>
<p>
This special treatment of stray cat pages is removed if 
support for compressed manual pages is turned off or not available.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
<h2>Formatting</h2>
<a name="toc32">&#160;</a>
<a name="toc33">&#160;</a>
<br>
<p>
As already pointed out in the introduction, there are two primary
formatters common to <b>UNIX</b>: <b>NROFF</b> and <b>TROFF</b>.<tt> </tt>
<p>
In the following sections, I 
will use the term <b>TROFF</b> to describe the typesetter formatter and <b>NROFF</b> to
describe the typewriter formatter. The term ROFF will be used to describe
a generic formatter.<tt> </tt>
   .<tt> </tt>
<h2><b>GROFF</b></h2>
<a name="toc34">&#160;</a>
<br>
<p>
If using the <b>GROFF</b> package, there is a further choice, <b>GROFF</b> itself.<tt> </tt>
Essentially, <b>GROFF</b> forms a pipeline of processors including <b>TROFF</b> and an output
processor which translates the ditroff produced by <b>TROFF</b> into the appropriate
output format. The default output format, or device, for <b>GROFF</b> is PostScript. 
Anything else must be specified using the device argument.<tt> </tt>
To illustrate <b>GROFF</b>, the command
<ul>
<li>groff -Tdvi /dev/null
</ul>
<p>
will form the following pipeline
<ul>
<li>troff -Tdvi /dev/null | grodvi
</ul>
<p>
If <b>GROFF</b> is tied to 
<b>man's
</b><b>-T
</b>option, it is still possible for 
<b>man
</b>to produce ditroff via use of the 
<b>-Z
</b>option.<tt> </tt>
<p>
In <b>GROFF</b> 1.09, <b>NROFF</b> is bundled as a shell script that calls <b>GROFF</b>, which in turn
calls <b>TROFF</b> with the default options
<b>-Wall -mtty-char -Tascii</b>,
passing the result through 
<b>grotty
</b>before it finally reaches the screen. 
<p>
It is imperative that the script does not pass pre-processing options 
to <b>GROFF</b>
command line as 
<b>man
</b>takes care of this separately. The file
<i>tools/nroff_script
</i>may be used as a basis for an <b>NROFF</b> script if your system is without one.<tt> </tt>
   .<tt> </tt>
<h2>Devices</h2>
<a name="toc35">&#160;</a>
<br>
<p>
Both <b>NROFF</b> and <b>GROFF</b> may allow output device selection. As mentioned previously,
classic <b>NROFF</b> produces output suitable for a typewriter device, classic
<b>TROFF</b> produces output suitable for a 
<b>C/A/T
</b>and <b>GROFF</b> produces output suitable for a PostScript interpreting device. 
   .<tt> </tt>
<h2>Macros</h2>
<a name="toc36">&#160;</a>
<br>
<p>
There are several ROFF macros in existence that are suitable for manual
pages.<tt> </tt>
Unfortunately, they tend to be incompatible with each other.<tt> </tt>
<p>
During configuration, 
<b>configure
</b>will attempt to determine a suitable macro for the local system's manual page
collection. It attempts to use <b>NROFF</b> with the following three macro packages:

<pre>        +---------------+----------------+---------------+
        | macro package | macro filename | nroff command |
        +---------------+----------------+---------------+
        | andoc         | tmac.andoc     | nroff -mandoc |
        | an            | tmac.an        | nroff -man    |
        | doc           | tmac.doc       | nroff -mdoc   |
        +---------------+----------------+---------------+
</pre>

The first that succeeds is used. Macro
<b>andoc
</b>is suitable for manual pages written using either
<b>an
</b>or
<b>doc
</b>macro commands, but not a combination of both.<tt> </tt>
<p>
   .<tt> </tt>
<h2>Pre-format processors (pre-processors)</h2>
<a name="toc37">&#160;</a>
<br>
<p>
Manual pages may require pre-processing by any of the following


<pre>                +---------+----+------------------+
                | Program | ID | Pre-processes    |
                +---------+----+------------------+
                | eqn     | e  | equations        |
                | tbl     | t  | tables           |
                | grap    | g  | graphs           |
                | pic     | p  | pictures         |
                | refer   | r  | A bibliography   |
                | vgrind  | v  | program listings |
                +---------+----+------------------+
</pre>

It is possible to assign a default pre-processor list that all 
manual pages will be passed through prior to the primary formatter. By
default, this is empty. To define a default list, edit
<i>include/manconfig.h
</i>and un-comment the following line
<p>
/* #define DEFAULT_MANROFFSEQ   "t" */
<p>
which will enable
<b>tbl
</b>processing by default. To change the list, replace the 
<b>t
</b>with a suitable string of processor ID's.<tt> </tt>
<p>
Pre-process options may be provided at run time in various forms, but in
general the pre-processors required by each manual page is indicated in the
first line of the manual page itself. See 
<b>man</b>(1)
for details.  
   .<tt> </tt>
<h2>Format scripts</h2>
<a name="toc38">&#160;</a>
<br>
<p>
It is very likely that alternate systems manual pages may require
non-standard macro packages or possibly even special pre-processors.<tt> </tt>
To tackle such problems, special format scripts may be created on a per
manual hierarchy basis.<tt> </tt>
<p>
If the file
<ul>
<li><i>&lt;manual_hierarchy&gt;/mandb_nfmt
</i></ul>
<p>
exists and is executable, it is expected to be able to correctly format a
manual page originating from 
<i>&lt;manual_hierarchy&gt;
</i>to its standard output. It will be supplied with either two or three
arguments:
<dl><dt><dd>+ manual page filename 
<br>
+ pre-processor string
<br>
+ ouput device (optional)
<br>
</dl>
Similarly, if the option
<b>-T</b><i>&lt;device&gt;
</i>
or
<b>-t
</b>was supplied to 
<b>man
</b>and the file
<ul>
<li><i>&lt;manual_hierarchy&gt;/mandb_tfmt
</i></ul>
<p>
exists and is executable, it will be used in the same way.<tt> </tt>
<p>
An example of such a script, supplied by Markus Armbruster
&lt;armbru@pond.sub.org&gt;, who provided support for external formatter scripts, 
can be found as
<i>tools/mandb_[nt]fmt
</i><p>
The script can be used as both a <b>NROFF</b> and <b>TROFF</b>/<b>GROFF</b> format script and can be
installed as 
<i>mandb_nfmt
</i>and hard linked to 
<i>mandb_tfmt
</i>after modification appropriate for your particular site.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
<h2>The index database caches</h2>
<a name="toc39">&#160;</a>
<a name="toc40">&#160;</a>
<br>
<p>
As mentioned in the introduction, man_db-2.3.x uses database lookups to search for
manual page locations and information. When performing a manual page lookup
or a basic 
<b>whatis
</b>search, the databases are searched in 
<ul>
<li><i>key -&gt; content
</i></ul>
<p>
mode and are as fast as the underlying databases can be. When performing 
<b>apropos
</b>or special 
<b>whatis
</b>searches, the databases are searched in a linear way, which although far
more expensive than 
<i>keyed
</i>lookup, is no worse than traditional text based file searching.<tt> </tt>
   .<tt> </tt>
<h2>index database location</h2>
<a name="toc41">&#160;</a>
<br>
<p>
The databases are always located at the root of the cat page hierarchy,
whether this is the same as the manual page hierarchy or not.<tt> </tt>
As file locking mechanisms are employed to ensure that concurrent
processes do not update a database simultaneously, it is almost imperative
that the databases reside on a local filesystem since file locking across
NFS filesystems may be unavailable or flaky. To avoid such problems, 
<b>man
</b>can be compiled without database maintenance support.<tt> </tt>
See the
section titled "Modes of operation" for details.<tt> </tt>
   .<tt> </tt>
<h2>Manual hierarchies with no index database  </h2>
<a name="toc42">&#160;</a>
<br>
<p>
It is possible for the man_db-2.3.x utilities to operate without aid from an index
database. Under such circumstances, search methods will resort to file
globbing and whatis type searches are performed on any traditional whatis
text databases that may exist. 
Only the traditional cat hierarchy is searched for cat files. 
   .<tt> </tt>
<h2>User manual page hierarchies</h2>
<a name="toc43">&#160;</a>
<br>
<p>
A user may have any number of personal manual page hierarchies listed in
their 
$<b>MANPATH</b>.<tt> </tt>

By default, 
<b>man
</b>will maintain 
<b>mandb
</b>created databases at the root of user manual page
hierarchies. 
The definition of a user manual hierarchy is that it
does not have an entry in the man_db configuration file. See 
<b>manpath</b>(5)
for details.<tt> </tt>
   .<tt> </tt>
<h2>Contents of an index database</h2>
<a name="toc44">&#160;</a>
<br>
<p>
There are four kinds of entry in an index database.<tt> </tt>
<dl compact>
<dt>1<dd>A direct entry regarding a particular manual page.<tt> </tt>
Manual pages that are unique in terms of name use just a single entry
in the database and can be looked up by simply using the name as the key.<tt> </tt>
<dt>2<dd>A common name index entry that lists the extensions of all of the manual
pages sharing the common index entry name.<tt> </tt>
Manual pages that share common names, but have differing extensions each
have a single database entry, but this time they are looked up with a key
comprised of their name and their extension. The entire set of common named
pages also has an common name index entry that informs of the extensions 
available.<tt> </tt>
<dt>3<dd>An indirect entry that has a pointer to the real entry. Manual pages that
are whatis references to a particular page do not physically exist so they
have a pointer to the entry containing the location of the real manual page.<tt> </tt>
<dt>4<dd>Special identification entries. There are two special key names, 
``$mtime$''
that references an integer describing the last modification time of the
database and
``$version$''
that identifies the database storage scheme version.<tt> </tt>
</dl>
<p>
In the following entries, the character 
``|''
will be used to separate the fields. In reality a tab is used.<tt> </tt>
Direct and indirect entries takes the form:
<ul>
<li><i>&lt;name&gt; -&gt; &lt;ext&gt;|&lt;sec&gt;|&lt;mtime&gt;|&lt;ID&gt;|&lt;ref&gt;|&lt;comp&gt;|&lt;whatis&gt;
</i></ul>
<p>
Common name index entries take the form:
<ul>
<li><i>&lt;name&gt; -&gt; |&lt;ext1&gt;|&lt;ext2&gt;|&lt;ext3&gt;| ... &lt;extn&gt;
</i></ul>
<p>
and common name direct or indirect entries take the form:
<ul>
<li><i>&lt;name&gt;|&lt;ext&gt; -&gt; &lt;ext&gt;|&lt;sec&gt;|&lt;mtime&gt;|&lt;ID&gt;|&lt;ref&gt;|&lt;comp&gt;|&lt;whatis&gt;
</i></ul>
<p>
where in each case the filename being represented is formed as
<ul>
<li><i>&lt;manual_hierarchy&gt;/man&lt;sec&gt;/&lt;name&gt;.&lt;ext&gt;.&lt;comp&gt;
</i></ul>
<p>
in the case of a manual page, or
<ul>
<li><i>&lt;cat_hierarchy&gt;/cat&lt;sec&gt;/&lt;name&gt;.&lt;ext&gt;.&lt;comp&gt;
</i></ul>
<p>
in the case of a stray cat.<tt> </tt>
<p>
If any of the fields would be empty, a single 
``-''
is stored in its place.<tt> </tt>
<i>&lt;comp&gt;
</i>represents the compression extension. 
<i>&lt;mtime&gt;
</i>is an integer representing the last modification time of the manual page,
<i>&lt;ref&gt;
</i>points to the entry containing the location of the real page and 
<i>&lt;ID&gt;
</i>is one of the following identification letters.<tt> </tt>

<pre>+---+------------+--------------------------------------------------------+
|ID | #define    | Description                                            |
+---+------------+--------------------------------------------------------+
| A | ULT_MAN    | ultimate manual page, the full source nroff file       |
| B | SO_MAN     | manual page containing a .so request to an ULT_MAN     |
| C | WHATIS_MAN | virtual whatis referenced page pointing to an ULT_MAN  |
| D | STRAY_CAT  | cat page with no source manual page                    |
| E | WHATIS_CAT | virtual whatis referenced page pointing to a STRAY_CAT |
+---+------------+--------------------------------------------------------+
</pre>

The
<i>ID
</i>illustrates the precedence. Some types of manual page can be referenced by
several means, e.g. .so requested and whatis referred. In such a case, only
one reference must be stored in the database, the precedence level decides
which.<tt> </tt>
   .<tt> </tt>
<h2>Favouring stray cats</h2>
<a name="toc45">&#160;</a>
<br>
<p>
With the above rules of precedence, it is possible for a valid stray cat page
to be replaced by a whatis referred page sharing identical name-space.<tt> </tt>
<p>
If you would like to see the stray cat page  
<b>kill</b>(1)
instead of the
<b>bash_builtins</b>(1)
page referenced by 
<b>kill</b>(1)
edit 
<i>include/manconfig.h
</i>and un-comment the following line
<p>
/* #define FAVOUR_STRAYCATS */
   .<tt> </tt>
<h2>Accessdb</h2>
<a name="toc46">&#160;</a>
<br>
<p>
A simple program, 
<b>accessdb
</b>is included with man_db-2.3.x. It will output the data contained within a man_db 
database in a human readable form. By default, it will 
<i>dump
</i>the data from 
<i>/var/catman/index.&lt;db-type&gt;</i>,
where 
<i>&lt;db-type&gt;
</i>is dependent on the database library in use.<tt> </tt>
<p>
Supplying an argument to 
<b>accessdb
</b>will override this default. 
Tabs are replaced in the output by a tilde
``~''
in the 
<i>key
</i>field and a single space in the 
<i>content
</i>field
<p>
<b>accessdb
</b>is not compiled by default. Type
<ul>
<li>make accessdb
</ul>
<p>
in the src directory to compile it.<tt> </tt>
   .<tt> </tt>
<h2>Example database</h2>
<a name="toc47">&#160;</a>
<br>
<p>
As an example of both 
<b>accessdb
</b>and the database storage method, the output of
<ul>
<li>src/accessdb man/index.bt
</ul>
<p>
after first running
<ul>
<li>src/mandb man
</ul>
<p>
from the top level build directory is included below.<tt> </tt>
<p>
$mtime$ -&gt; "795987034"
<br>
$version$ -&gt; "2.3.1"
<br>
apropos -&gt; "1 1 795981542 A - - search the manual page names and descriptions"
<br>
catman -&gt; "8 8 795981544 A - - create or update the pre-formatted manual pages"
<br>
man -&gt; "1 1 795981542 A - - an interface to the on-line reference manuals"
<br>
mandb -&gt; "8 8 795981544 A - - create or update the manual page index caches"
<br>
manpath -&gt; " 1 5"
<br>
manpath~1 -&gt; "1 1 795981542 A - - determine search path for manual pages"
<br>
manpath~5 -&gt; "5 5 795981543 A - - format of the /etc/man_db.config file"
<br>
whatis -&gt; "1 1 795981543 A - - search the manual page names"
<br>
zsoelim -&gt; "1 1 795981543 A - - satisfy .so requests in roff input"
<br>
   .<tt> </tt>
<h2>Database types</h2>
<a name="toc48">&#160;</a>
<br>
<p>
man_db-2.3.x has support for various low level database libraries commonly in use
today.<tt> </tt>
The interfaces to the libraries are known as
ndbm (<b>UNIX</b>)
gdbm (<b>GNU</b>)
btree (Berkeley DB)
<p>
man_db-2.3.x currently does not hold more than one database open at any time, so 
dbm (<b>UNIX</b>)
<p>
support could be added in the future.<tt> </tt>
   .<tt> </tt>
<h2>limitations</h2>
<a name="toc49">&#160;</a>
<br>
<p>
The general differences and limitations are best compared in a table.<tt> </tt>

<pre>+------+-------------+----------+-----------------+--------------+-----------+
|      |             |  File    | Content memory  |  Concurrent  |           |
|Name  |    Type     |          +---------+-------+              | Shareable |
|      |             |  name    |  type   | limit |    access    |           |
+------+-------------+----------+---------+-------+--------------+-----------+
|ndbm  | hash        | index    | static  |  1Kb  |     none     |    no     |
|gdbm  | hash        | index.db | dynamic |   -   | file locking |    no     |
|btree | binary tree | index.bt | static  |   -   |     none     |    yes    |
+------+-------------+----------+---------+-------+--------------+-----------+
</pre>

Those types that have no built in concurrent access strategy, are provided
with 
<b>flock</b>(2)
based file locking by man_db-2.3.x.<tt> </tt>
<p>
As 
<b>btree
</b>is noticeably faster when doing 
<b>man
</b>searches, mainly due to the fast initialization of the databases, it is the
preferred library interface.<tt> </tt>
<b>configure
</b>will look for 
<b>btree</b>,
<b>gdbm
</b>and then finally
<b>ndbm
</b>routines when configuring man_db-2.3.x.<tt> </tt>
   .<tt> </tt>
<h2>Sharing databases in a heterogeneous environment</h2>
<a name="toc50">&#160;</a>
<br>
It may be necessary or advantageous to share databases across
platforms, regardless of the potential file locking problems.<tt> </tt>
<p>
An example would be a user having a personal manual page hierarchy in an NFS
based home directory environment, whereby the home directory is held on and
mounted from a single machine in a heterogeneous network.<tt> </tt>
<p>
In this context, the database cache will have the same name and reside in
the same place on all machines. There are at least two ways to deal with
this problem.<tt> </tt>
Hack the 
<i>include/manconfig.h
</i>file on each platform to provide a unique database name for each system. No
databases will be shared.<tt> </tt>
Install and use the Berkeley DB database interface library on each platform.<tt> </tt>
These databases can be shared across big-endian/little-endian platforms
although a database created on a big-endian platform will suffer a small
access penalty when used by a litle-endian machine and vice-versa.<tt> </tt>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
   .<tt> </tt>
<br>
<h2>Miscellaneous</h2>
<a name="toc51">&#160;</a>
<a name="toc52">&#160;</a>
<br>
   .<tt> </tt>
<h2>Modes of operation</h2>
<a name="toc53">&#160;</a>
<br>
<p>
The man_db utilities can operate in many different modes, allowing varying
degrees of freedom, functionality and security. No mode requires that the 
manual page hierarchies be writable. 
<p>
<dl compact>
<dt>(1) Default mode<dd><b>man
</b>is setuid to the user MAN_OWNER which is `man' by default and is changeable 
via
options to 
<b>configure</b>.<tt> </tt>
<b>mandb</b>,
if run by the superuser or MAN_OWNER, creates globally accessible index 
databases owned by MAN_OWNER.<tt> </tt>
Once the databases are created, 
<b>man
</b>will update entries in them if it finds newly installed
manual pages or delete  entries if manual pages are removed.<tt> </tt>
In this mode it is possible for a malicious 
<b>man
</b>user to deliberately lock a database as a writer, thus denying read access to
other users.<tt> </tt>
<br>
If cat directories exist and
have the correct permissions, 
<b>man
</b>will take care of producing cat files. 
These will be owned by MAN_OWNER. The default
permissions of both cat files and databases are 0644.<tt> </tt>
<dt>(2) No man database updates<dd>This mode also requires 
<b>man
</b>to be setuid, but is favoured where databases must be shared in an
environment unfriendly to kernel locking procedures, eg. NFS. It also
prevents possible `denial of service' attacks by malicious 
<b>man
</b>users as 
<b>man
</b>never opens the databases as a writer in this mode.<tt> </tt>
To replace the functionality lost by disallowing 
<b>man
</b>write access to the databases, 
<b>mandb
</b>must be rerun whenever new manual pages are installed. 
Failure to do so will result in 
<b>man
</b>being unable to find and display the newly added manual pages.<tt> </tt>
As
<b>mandb
</b>lacks the ability to delete database entries for manual pages that have been
removed, it is necessary to use the
<b>--create
</b>flag whenever manual pages are removed from the filesystem.<tt> </tt>
Each index database may be owned by an arbitrary user who will have
subsequent write access to the database.<tt> </tt>
Cat files are created in the same way as for mode (1) above.<tt> </tt>
<br>
To use the man_db utilities in this mode, edit
<i>include/manconfig.h
</i>and comment out 
`#define MAN_DB_UPDATES'
<dt>(3) No man database updates or cat production<dd><b>man
</b>is installed not setuid.<tt> </tt>
This mode of operation probably offers the highest level of security but
it requires higher levels of maintenance than other modes due to the 
restrictions imposed upon 
<b>man</b>.<tt> </tt>
Each database is
owned by an arbitrary user as in mode (2). Each cat hierarchy is also owned by
an arbitrary user who is responsible for creating cat files using 
<b>catman
</b>whenever new manual files are installed. 
<b>man
</b>will be completely passive in it's action, ie. no index databases will be
written to and no cat files are ever produced.<tt> </tt>
<br>
To use the man_db utilities in this mode, supply the option
`--disable-setuid' to 
<b>configure
</b>and edit 
<i>include/manconfig.h</i>,
commenting out `#define MAN_DB_UPDATES' and `#define MAN_CATS'
after running
<b>configure</b>.<tt> </tt>
<dt>(4) Wide open<dd><b>man
</b>is installed not setuid.<tt> </tt>
This mode is similar in operation to the majority of vendor supplied, non
setuid, cat file supporting manual pager suites. It is not recommended.<tt> </tt>
The databases are owned by an arbitrary user who maintains them using 
<b>mandb</b>.<tt> </tt>
<b>man
</b>does not update the databases.<tt> </tt>
Cat files are produced and stored in world writable cat directories and have
world write access themselves.<tt> </tt>
<br>
To use the man_db utilities in this mode, supply the option
`--disable-setuid' to 
<b>configure</b>,
edit 
<i>include/manconfig.h
</i>and comment out `#define MAN_DB_UPDATES' and change the definition of
CATMODE from 0644 to 0666.<tt> </tt>
</dl>
<p>
Other variations can also be used. In fact it is possible for 
<b>man
</b>to actually create index databases, usually the job of 
<b>mandb</b>,
for users private manual page hierarchies. This is enabled by editing
<i>include/manconfig.h
</i>and un-commenting the `/* #define MAN_DB_CREATES */' line. man_db-2.2
operated in this manner.<tt> </tt>
<p>
In summary, 
<i>include/manconfig.h
</i>contains definitions for
MAN_DB_CREATES
MAN_DB_UPDATES
MAN_CATS
CATMODE
DBMODE
<p>
and the setuid installation and operation of
<b>man
</b>is modified by supplying either of the following options to 
<b>configure</b>:
--enable-setuid=USER
--disable-setuid
   .<tt> </tt>
<h2>NFS root squash</h2>
<a name="toc54">&#160;</a>
<br>
<p>
If 
<b>man
</b>is installed setuid to an arbitrary user and is run by root, instead of
gaining the effective user id of the setuid user, 
<b>man
</b>is run with both uid and euid as root.  This is neccesary due to
infelicities with the
<b>POSIX
</b>setuid() function call:  All users except root may change to and from the
effective (setuid) user, however once root has setuid(user), there is no way
back.<tt> </tt>
<p>
A side effect of this is that 
<b>NFS
</b>mounted cat hierarchies or databases will be unwritable if the following
conditions exist:
man/catman/mandb is run by root
The NFS mount has the root squash flag set
<p>
To get around this problem, the root user must first attain the ID of the
cat hierarchy or database owner before running 
<b>man/catman/mandb
</b>whenever the databases need updating or cat files are to be produced.<tt> </tt>
   .<tt> </tt>
<h2>NLS message catalogues</h2>
<a name="toc55">&#160;</a>
<br>
<p>
man_db-2.3.x has built in support for native language message catalogues. That is, it
can issue messages in the locale of the users choice. This will only occur if 
the locale's translation has been written. Before undertaking a translation,
please contact the author who will be maintaining a list of such activity.<tt> </tt>
<p>
Currently, the following translations exist
de_DE.88591
   .<tt> </tt>
<h2>Credits</h2>
<a name="toc56">&#160;</a>
<br>
<p>
I would like to thank the following people for their time, effort, support,
ideas and code which went into man_db-2.3.x
<dl><dt><dd>Markus Armbruster &lt;armbru@pond.sub.org&gt;
<br>
Lionel Cons &amp; colleages &lt;cons@dxcern.cern.ch&gt;
<br>
Carl Edman &lt;cedman@princeton.edu&gt;
<br>
Caleb Epstein &lt;epstein_caleb@jpmorgan.com&gt;
<br>
Lars Fenneberg &lt;lf@gimli.comlink.de&gt;
<br>
Zoltan Hidvegi &lt;hzoli@cs.elte.hu&gt;
<br>
Nils Magnus &lt;magnus@unix-ag.uni-kl.de&gt;
<br>
Daniel Quinlan &lt;quinlan@yggdrasil.com&gt;
<br>
</dl>
<!--  table of contents page -->
<!--  no header  -->
<!--  pagenumber footer -->
<!--  reset pagenumber to 1 -->
<br>
<!--  set pagenumber register to roman numerals -->
<br>
<center>
<h2>Glossary</h2>
</center>
<p>
<!--  Copyright (C), 1995, Graeme W. Wilford. (Wilf.) -->
<!--  You may distribute under the terms of the GNU General Public -->
<!--  License as specified in the file COPYING that comes with the -->
<!--  man_db distribution. -->
<!--  Thu Sep 21 19:22:47 BST 1995  Wilf. (G.Wilford@ee.surrey.ac.uk)  -->
<!--   -->
<dl compact>
<dt>manual page<dd>A file containing descriptions related to the use of a function or program 
or the structure of a file. The name of the file is formed from the title of
the manual page followed by a period followed by the name of the section
that it resides in, optionally followed by an extension. The format of the 
file is <b>NROFF</b> and may be compressed, having a suitable compression extension
appended.<tt> </tt>
<dt>cat page<dd>A formatted manual page suitable for viewing on a vt100-type terminal.<tt> </tt>
<dt>stray cat page<dd>A cat page that does not have a relative manual page on the system, ie. only
the cat page was supplied or the manual page was removed after the cat page
had been created.<tt> </tt>
<dt>section<dd>Each manual page or cat page hierarchy is divided into sections, each
section having it's own directory. manual page hierarchy section names
begin with `man' and cat page sections with `cat'.<tt> </tt>
<dt>extension<dd>A package may provide manual pages with filenames ending in a
package-specific extension name. This allows manual pages with the same
title to coexist in the same manual page hierarchy and section without
sharing the same filename.  It also provides a further mechanism for man
to select the correct manual page.<tt> </tt>
<dt>manual page hierarchy<dd>A directory tree divided into manual page sections, each containing a 
collection of manual pages.<tt> </tt>
<dt>cat page hierarchy<dd>A directory tree divided into cat page sections, each containing a 
collection of 
cat pages.<tt> </tt>
<dt>traditional cat page hierarchy<dd>The same location as the manual page hierarchy.<tt> </tt>
<dt>alternate cat page hierarchy<dd>A separate location to that of the traditional cat page hierarchy.<tt> </tt>
<dt>traditional cat page<dd>A cat page located in a traditional cat page hierarchy.<tt> </tt>
<dt>alternate cat page<dd>A cat page located in an alternate cat page hierarchy.<tt> </tt>
<br>
<center>
<br>
<h2>Contents</h2>
</center>
<p>
</dl>
<a href="#toc0"><p>
</a>
<br>
<a href="#toc1">1.  Introduction
</a>
<br>
<a href="#toc2">1.1  man_db-2.3.x
</a>
<br>
<a href="#toc3">1.1.1  The concept
</a>
<br>
<a href="#toc4">1.2  The manual page system
</a>
<br>
<a href="#toc5">1.3  Sections of the manual
</a>
<br>
<a href="#toc6">1.4  The format of manual pages
</a>
<br>
<a href="#toc7">1.5  Arguments to configure
</a>
<br>
<a href="#toc8"><p>
</a>
<br>
<a href="#toc9">2.  The specifics of Sections
</a>
<br>
<a href="#toc10">2.1  Package specific manual page sections
</a>
<br>
<a href="#toc11">2.2  Selecting a section type
</a>
<br>
<a href="#toc12">2.2.1  Specifying a section
</a>
<br>
<a href="#toc13">2.2.2  Specifying an extension
</a>
<br>
<a href="#toc14"><p>
</a>
<br>
<a href="#toc15">3.  Filesystem structure
</a>
<br>
<a href="#toc16">3.1  Manual page hierarchies
</a>
<br>
<a href="#toc17">3.2  Setting the MANPATH
</a>
<br>
<a href="#toc18">3.3  Determination of the internal manpath
</a>
<br>
<a href="#toc19">3.4  Other OS's manual pages
</a>
<br>
<a href="#toc20">3.5  NLS manual pages
</a>
<br>
<a href="#toc21">3.5.1  ISO 8859-1 (latin1) manual pages
</a>
<br>
<a href="#toc22">3.5.2  Displaying latin1 characters on a Linux virtual terminal
</a>
<br>
<a href="#toc23">3.5.3  Viewing ASCII pages formatted for latin1 output device
</a>
<br>
<a href="#toc24">3.6  Cat pages
</a>
<br>
<a href="#toc25">3.7  Cat page hierarchies
</a>
<br>
<a href="#toc26">3.8  Local cat page directory caches
</a>
<br>
<a href="#toc27"><p>
</a>
<br>
<a href="#toc28">4.  Compression
</a>
<br>
<a href="#toc29">4.1  Compressed manual pages
</a>
<br>
<a href="#toc30">4.2  Compressed cat pages
</a>
<br>
<a href="#toc31">4.2.1  Stray cats
</a>
<br>
<a href="#toc32"><p>
</a>
<br>
<a href="#toc33">5.  Formatting
</a>
<br>
<a href="#toc34">5.1  <b>GROFF</b>
</a>
<br>
<a href="#toc35">5.2  Devices
</a>
<br>
<a href="#toc36">5.3  Macros
</a>
<br>
<a href="#toc37">5.4  Pre-format processors (pre-processors)
</a>
<br>
<a href="#toc38">5.5  Format scripts
</a>
<br>
<a href="#toc39"><p>
</a>
<br>
<a href="#toc40">6.  The index database caches
</a>
<br>
<a href="#toc41">6.1  index database location
</a>
<br>
<a href="#toc42">6.1.1  Manual hierarchies with no index database  
</a>
<br>
<a href="#toc43">6.1.2  User manual page hierarchies
</a>
<br>
<a href="#toc44">6.2  Contents of an index database
</a>
<br>
<a href="#toc45">6.2.1  Favouring stray cats
</a>
<br>
<a href="#toc46">6.2.2  Accessdb
</a>
<br>
<a href="#toc47">6.2.3  Example database
</a>
<br>
<a href="#toc48">6.3  Database types
</a>
<br>
<a href="#toc49">6.4  limitations
</a>
<br>
<a href="#toc50">6.5  Sharing databases in a heterogeneous environment
</a>
<br>
<a href="#toc51"><p>
</a>
<br>
<a href="#toc52">7.  Miscellaneous
</a>
<br>
<a href="#toc53">7.1  Modes of operation
</a>
<br>
<a href="#toc54">7.2  NFS root squash
</a>
<br>
<a href="#toc55">7.3  NLS message catalogues
</a>
<br>
<a href="#toc56">7.4  Credits
</a>
<br>
<h2>Footnotes</h2>
<br>
<a name="footnote1"></a><b>[1]</b> originally conceived after observing the actions of the perl based
manual pager suite, man-pl written by Tom Christiansen
&lt;tchrist@convex.com&gt;
<br>
<a name="footnote2"></a><b>[2]</b> one line description of the manual page
<br>
<a name="footnote3"></a><b>[3]</b> similar in some aspects to 
<b>TeX
</b><br>
<a name="footnote4"></a><b>[4]</b> Written and maintained by James Clark &lt;jjc@jclark.com&gt;
<br>
<a name="footnote5"></a><b>[5]</b> writing portable software instantly comes to mind
<br>
<a name="footnote6"></a><b>[6]</b> written and maintained by Daniel Quinlan &lt;quinlan@yggdrasil.com&gt;
<br>
<a name="footnote7"></a><b>[7]</b> see 
<b>nroff</b>(5)
for the output device formats available with your <b>NROFF</b>
<br>
<a name="footnote8"></a><b>[8]</b> written and maintained by Andries Brouwer &lt;aeb@cwi.nl&gt;.<tt> </tt>
Version 0.90 and above does not require the use of 
<b>mapscrn
</b>as illustrated in the script.<tt> </tt>
<br>
<a name="footnote9"></a><b>[9]</b> The ISO 8859-1 and ASCII columns of this table will be identical if this
manual was formatted for an ASCII based typewriter display, i.e. using <b>NROFF</b>
in it's native mode.<tt> </tt>
<br>
<a name="footnote10"></a><b>[10]</b> cat files that have no source manual page, i.e. they cannot be recreated.<tt> </tt>
<br>
<a name="footnote11"></a><b>[11]</b> ndbm databases are physically represented by two files: 
<i>index.dir
</i>and
<i>index.pag
</i>but are referred to simply as
<i>index
</i>by the interface routines.<tt> </tt>
<br>
</body>
</html>
